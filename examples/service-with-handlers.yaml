recordingrule:
- expr: "sum by (status_class) (\n  label_replace(\n    rate(haproxy_server_http_responses_total{route=\"\
    bar-prod\"}[5m]\n  ), \"status_class\", \"${1}xx\", \"code\", \"([0-9])..\")\n\
    )\n"
  labels:
    component: bar
    route: bar-prod
    service: foo
  record: status_class:http_responses_total:rate5m
- expr: 'sum(status_class:http_responses_total:rate5m{route="bar-prod",status_class="5xx"})

    /

    sum(status_class:http_responses_total:rate5m{route="bar-prod"})

    '
  labels:
    component: bar
    route: bar-prod
    service: foo
  record: status_class_5xx:http_responses_total:ratio_rate5m
- expr: "histogram_quantile(\n  0.95,\n  sum(rate(foo_upload_seconds_bucket{selector=\"\
    qux\"}[5m])) by (le)\n)\n"
  labels:
    component: bar
    job: read
    selector: qux
    service: foo
  record: component:latency:p95_rate5m
- expr: "histogram_quantile(\n  0.95,\n  sum(rate(foo_upload_seconds_bucket{selector=\"\
    qux\"}[5m])) by (le)\n)\n"
  labels:
    component: bar
    job: write
    selector: qux
    service: foo
  record: component:latency:p95_rate5m
- expr: status_class:http_responses_total:rate5m{route="bar-prod",status_class!="5xx"}
    < bool(100)
  labels:
    component: bar
    route: bar-prod
    service: foo
  record: component:volume:slo_ok_5m
- expr: component:latency:p95_rate5m < bool(0.1)
  labels:
    component: bar
    job: read
    selector: qux
    service: foo
  record: component:latency:slo_ok_5m
- expr: component:latency:p95_rate5m < bool(0.1)
  labels:
    component: bar
    job: write
    selector: qux
    service: foo
  record: component:latency:slo_ok_5m
- expr: status_class_5xx:http_responses_total:ratio_rate5m{route="bar-prod"} < bool(0.001)
  labels:
    component: bar
    route: bar-prod
    service: foo
  record: component:errors:slo_ok_5m
- expr: component:errors:slo_ok_5m * component:latency:slo_ok_5m{job="read"} * component:latency:slo_ok_5m{job="write"}
  labels:
    component: bar
    route: bar-prod
    service: foo
  record: component:availability:slo_ok_5m
